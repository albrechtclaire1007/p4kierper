<!DOCTYPE html>
<html lang="lb">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>P4 – Layout Master</title>

<style>
@font-face{
  font-family:'Schoulschrëft';
  src:url('https://raw.githubusercontent.com/albrechtclaire1007/schoulschreft/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
  font-weight:bold; font-style:normal; font-display:swap;
}

:root{
  /* P4 (matching your provided style) */
  --bg1:#E9DDF7;
  --bg2:#C9B3EE;

  --bar:#B8A3E8;
  --barBorder:#8E73D6;

  --ink:#1f1f1f;
  --white:#fff;
  --border:3px;
  --shadow:0 10px 24px rgba(0,0,0,.08);
  --pad:clamp(10px,2.2vw,16px);
  --r:18px;

  --iconArrow:"https://i.postimg.cc/k6VtHrh0/p4arrow.png";
  --iconPlay:"https://i.postimg.cc/WFDJyRHR/p4play.png";
  --iconReplay:"https://i.postimg.cc/BL81zWVs/p4replay.png";

  --good:#b7f0c8;
  --bad:#ffcccc;

  --btnBorder:3px;
  --btnBg:rgba(255,255,255,.88);
  --btnBd:rgba(0,0,0,.12);
}

*{box-sizing:border-box; -webkit-tap-highlight-color:transparent; user-select:none; outline:none;}
html,body{
  height:100%; margin:0;
  background:linear-gradient(135deg,var(--bg2),var(--bg1));
  color:var(--ink);
  font-family:'Schoulschrëft', Arial, sans-serif;
}

.topBar{
  position:sticky; top:10px; z-index:10;
  width:min(1200px,96vw);
  margin:10px auto 0;
  background:var(--bar);
  border:var(--border) solid var(--barBorder);
  border-radius:999px;
  box-shadow:var(--shadow);
  padding:10px 12px;

  display:grid;
  grid-template-columns: 70px 1fr auto;
  align-items:center;
  gap:10px;
}

.barBtn{
  border:none; background:transparent;
  cursor:pointer;
  display:grid; place-items:center;
  width:54px; height:54px;
}
.barBtn:active{transform:scale(.98);}
.barBtn img{width:46px; height:46px; object-fit:contain;}
.barBtn.back img{transform:rotate(180deg);}

.barTitle{
  text-align:center;
  color:#fff;
  font-size:clamp(1.5rem,3.2vw,2.4rem);
  margin:0;
  line-height:1.1;
  padding:0 6px;
}

.barRight{display:flex; align-items:center; gap:6px;}
.barRight .barBtn{width:50px; height:50px;}
.barRight .barBtn img{width:42px; height:42px;}

.wrap{
  width:min(1200px,96vw);
  margin:18px auto 26px;
  padding:var(--pad);
  display:flex;
  flex-direction:column;
  gap:14px;
}
.card{
  background:rgba(255,255,255,.8);
  border:var(--border) solid rgba(255,255,255,.65);
  border-radius:var(--r);
  box-shadow:var(--shadow);
  padding:clamp(12px,2.2vw,18px);
}
.cardTitle{margin:0 0 8px 0; font-size:clamp(1.1rem,2.2vw,1.5rem); opacity:.9;}
.placeholder{border:3px dashed rgba(0,0,0,.2); border-radius:14px; padding:18px; background:rgba(255,255,255,.55); font-size:1.05rem; opacity:.85;}

/* -------- GAME AREA (inside placeholder only) -------- */
.gameBox{width:100%;}

/* Game 1 */
.g1{
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:center;
}
.g1TopRow{
  width:100%;
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
.iconBtn{
  width:54px; height:54px;
  border-radius:999px;
  border:var(--btnBorder) solid var(--btnBd);
  background:var(--btnBg);
  box-shadow:0 6px 14px rgba(0,0,0,.06);
  display:grid; place-items:center;
  cursor:pointer;
  padding:0;
}
.iconBtn:active{transform:scale(.98);}
.iconBtn img{width:40px; height:40px; object-fit:contain;}
.iconBtn[disabled]{opacity:.55; cursor:not-allowed;}

.g1Slots{
  width:100%;
  display:flex;
  justify-content:center;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
  padding:12px 10px;
  border-radius:14px;
  border:3px solid rgba(0,0,0,.12);
  background:rgba(255,255,255,.65);
  box-shadow:0 6px 14px rgba(0,0,0,.05);
}
.slot{
  width:46px; height:46px;
  display:grid; place-items:center;
  border-radius:12px;
  border:3px dashed rgba(0,0,0,.18);
  background:rgba(255,255,255,.65);
  font-size:1.35rem;
}
.slot.filled{
  border-style:solid;
  border-color:rgba(0,0,0,.12);
  cursor:pointer;
}
.slot.good{background:rgba(183,240,200,.85);}
.slot.bad{background:rgba(255,204,204,.9);}

.g1Letters{
  width:100%;
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  padding:4px 0;
}
.letterBtn{
  min-width:52px; height:52px;
  padding:0 14px;
  border-radius:14px;
  border:3px solid rgba(0,0,0,.12);
  background:rgba(255,255,255,.92);
  box-shadow:0 6px 14px rgba(0,0,0,.06);
  cursor:pointer;
  font-family:'Schoulschrëft', Arial, sans-serif;
  font-size:1.35rem;
  display:grid; place-items:center;
}
.letterBtn:active{transform:scale(.99);}
.letterBtn[disabled]{opacity:.45; cursor:not-allowed;}

@keyframes shake{
  0%,100%{transform:translateX(0);}
  20%{transform:translateX(-6px);}
  40%{transform:translateX(6px);}
  60%{transform:translateX(-4px);}
  80%{transform:translateX(4px);}
}

/* Game 2 */
.g2{
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:center;
}
.g2Stage{
  width:100%;
  max-width:980px;
  position:relative;
  border-radius:18px;
  overflow:hidden;
  border:3px solid rgba(0,0,0,.12);
  background:rgba(255,255,255,.55);
  box-shadow:0 10px 24px rgba(0,0,0,.06);
}
.g2Stage::before{
  content:"";
  display:block;
  padding-top:141%;
}
.g2Img{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit:contain;
  pointer-events:none;
}
.hit{
  position:absolute;
  border-radius:999px;
  cursor:pointer;
  background:rgba(255,255,255,0);
  border:none;
  padding:0;
}
.hit:active{transform:scale(.995);}
.hit.flashGood{background:rgba(183,240,200,.45);}
.hit.flashBad{background:rgba(255,204,204,.55); animation:shake .25s linear;}

.wordOnPill{
  position:absolute;
  left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:92%;
  height:auto;
  pointer-events:none;
  filter:drop-shadow(0 6px 10px rgba(0,0,0,.10));
  display:none;
}

.bubble{
  position:absolute;
  width:112px; height:112px;
  border-radius:999px;
  display:grid; place-items:center;
  border:3px solid rgba(0,0,0,.12);
  background:rgba(255,255,255,.92);
  box-shadow:0 10px 22px rgba(0,0,0,.12);
  cursor:pointer;
  z-index:5;
  padding:0;
}
.bubble:active{transform:scale(.99);}
.bubble img{width:64px; height:64px; object-fit:contain;}
.bubble.armed{outline:4px solid rgba(142,115,214,.55); outline-offset:2px;}
.toast{
  position:fixed;
  left:50%; bottom:16px;
  transform:translateX(-50%);
  background:rgba(255,255,255,.92);
  border:3px solid rgba(0,0,0,.12);
  box-shadow:var(--shadow);
  border-radius:999px;
  padding:10px 14px;
  font-size:1.05rem;
  opacity:0;
  pointer-events:none;
  transition:opacity .18s ease, transform .18s ease;
  z-index:50;
}
.toast.show{opacity:1; transform:translateX(-50%) translateY(-4px);}
</style>
</head>

<body>

<div class="topBar">
  <button class="barBtn back" id="prev" aria-label="Virdrun">
    <img src="https://i.postimg.cc/k6VtHrh0/p4arrow.png" alt="">
  </button>

  <h1 class="barTitle" id="gameTitle">P4 – Titel vum Spill</h1>

  <div class="barRight">
    <button class="barBtn" id="play" aria-label="Play">
      <img src="https://i.postimg.cc/WFDJyRHR/p4play.png" alt="">
    </button>
    <button class="barBtn" id="replay" aria-label="Replay">
      <img src="https://i.postimg.cc/BL81zWVs/p4replay.png" alt="">
    </button>
    <button class="barBtn" id="next" aria-label="Nächst">
      <img src="https://i.postimg.cc/k6VtHrh0/p4arrow.png" alt="">
    </button>
  </div>
</div>

<div class="wrap">
  <div class="card">
    <p class="cardTitle"></p>
    <div class="placeholder" id="gameMount">
      <div class="gameBox" id="gameBox"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast">✔</div>

<script>
/* =========================
   DATA / CONTENT (EDITABLE)
   ========================= */

const AUDIO_BASE = "https://github.com/albrechtclaire1007/p4kierper/raw/refs/heads/main/";
const G2_BG = "https://i.postimg.cc/y6r9LvkP/Kierper-P4-blank.png";

const ITEMS = [
  {id:"a",         label:"d'A",        audio:"a.mp3",        wordImg:"https://i.postimg.cc/nXyLpCjf/a.png"},
  {id:"aarm",      label:"den Aarm",    audio:"aarm.mp3",     wordImg:"https://i.postimg.cc/18kzsfnQ/aarm.png"},
  {id:"bauch",     label:"de Bauch",    audio:"bauch.mp3",    wordImg:"https://i.postimg.cc/wtDjvgJG/bauch.png"},
  {id:"been",      label:"d'Been",      audio:"been.mp3",     wordImg:"https://i.postimg.cc/2qnS6rv9/been.png"},
  {id:"fanger",    label:"de Fanger",   audio:"fanger.mp3",   wordImg:"https://i.postimg.cc/bG1wJpbF/fanger.png"},
  {id:"fouss",     label:"de Fouss",    audio:"fouss.mp3",    wordImg:"https://i.postimg.cc/p9KLTR83/fouss.png"},
  {id:"hals",      label:"den Hals",    audio:"hals.mp3",     wordImg:"https://i.postimg.cc/DW1wZnsN/hals.png"},
  {id:"hand",      label:"d'Hand",      audio:"hand.mp3",     wordImg:"https://i.postimg.cc/B82n64Dy/hand.png"},
  {id:"henner",    label:"den Hënner",  audio:"henner.mp3",   wordImg:"https://i.postimg.cc/PL15xTZB/henner.png"},
  {id:"hoer",      label:"d'Hoer",      audio:"hoer.mp3",     wordImg:"https://i.postimg.cc/WD013TgL/hoer.png"},
  {id:"kapp",      label:"de Kapp",     audio:"kapp.mp3",     wordImg:"https://i.postimg.cc/yJ08dscq/kapp.png"},
  {id:"kenn",      label:"de Kënn",     audio:"kenn.mp3",     wordImg:"https://i.postimg.cc/WD013Tgc/kenn.png"},
  {id:"knei",      label:"de Knéi",     audio:"knei.mp3",     wordImg:"https://i.postimg.cc/94yQMCZj/knei.png"},
  {id:"mond",      label:"de Mond",     audio:"mond.mp3",     wordImg:"https://i.postimg.cc/3y2xRYmT/mond.png"},
  {id:"nues",      label:"d'Nues",      audio:"nues.mp3",     wordImg:"https://i.postimg.cc/94yQMCZV/nues.png"},
  {id:"ouer",      label:"d'Ouer",      audio:"ouer.mp3",     wordImg:"https://i.postimg.cc/7CSZ6w04/ouer.png"},
  {id:"reck",      label:"de Réck",     audio:"reck.mp3",     wordImg:"https://i.postimg.cc/GBvm2dGd/reck.png"},
  {id:"scheller",  label:"d'Schëller",  audio:"scheller.mp3", wordImg:"https://i.postimg.cc/7CSZ6w0q/scheller.png"},
  {id:"stier",     label:"d'Stier",     audio:"stier.mp3",    wordImg:"https://i.postimg.cc/DW1wZnLy/stier.png"},
  {id:"zand",      label:"den Zand",    audio:"zand.mp3",     wordImg:"https://i.postimg.cc/qt2vR4yB/zand.png"},
  {id:"zeif",      label:"d'Zéif",      audio:"zeif.mp3",     wordImg:"https://i.postimg.cc/Lqj8X2L8/zeif.png"}
];

/* Game 2 hit zones (percent-based; tweak if needed) */
const G2_HITS = [
  // LEFT BODY
  {id:"hals",     x: 6.5,  y: 11.8, w: 30.0, h: 5.6},
  {id:"scheller", x: 6.5,  y: 18.7, w: 30.0, h: 5.6},
  {id:"bauch",    x: 6.5,  y: 25.6, w: 30.0, h: 5.6},
  {id:"henner",   x: 6.5,  y: 32.5, w: 30.0, h: 5.6},
  {id:"hand",     x: 6.5,  y: 39.4, w: 30.0, h: 5.6},
  {id:"knei",     x: 6.5,  y: 52.7, w: 30.0, h: 5.6},
  {id:"zeif",     x: 6.5,  y: 65.6, w: 30.0, h: 5.6},

  // RIGHT BODY
  {id:"kapp",     x: 63.5, y: 11.8, w: 30.0, h: 5.6},
  {id:"fanger",   x: 63.5, y: 18.7, w: 30.0, h: 5.6},
  {id:"reck",     x: 63.5, y: 25.6, w: 30.0, h: 5.6},
  {id:"aarm",     x: 63.5, y: 32.5, w: 30.0, h: 5.6},
  {id:"been",     x: 63.5, y: 45.6, w: 30.0, h: 5.6},
  {id:"fouss",    x: 63.5, y: 65.6, w: 30.0, h: 5.6},

  // FACE
  {id:"stier",    x: 10.0, y: 79.6, w: 30.0, h: 5.4},
  {id:"a",        x: 10.0, y: 85.8, w: 30.0, h: 5.4},
  {id:"nues",     x: 10.0, y: 92.0, w: 30.0, h: 5.4},

  {id:"hoer",     x: 64.0, y: 82.3, w: 30.0, h: 5.4},
  {id:"ouer",     x: 64.0, y: 88.5, w: 30.0, h: 5.4},
  {id:"zand",     x: 64.0, y: 94.7, w: 30.0, h: 5.4},
  {id:"kenn",     x: 64.0, y: 100.0,w: 30.0, h: 0.0} // ignored
];

/* =========================
   END DATA / CONTENT
   ========================= */

const $ = (q,root=document)=>root.querySelector(q);
const box = $("#gameBox");
const titleEl = $("#gameTitle");
const toast = $("#toast");

let audio = new Audio();
audio.preload = "auto";
function playAudio(file){
  try{ audio.pause(); audio.currentTime = 0; }catch(e){}
  audio = new Audio(AUDIO_BASE + file);
  audio.preload = "auto";
  audio.play().catch(()=>{});
}
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"), 800);
}
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function coreFromLabel(label){
  const t = label.trim();
  const parts = t.split(" ");
  let core = (parts.length>=2) ? parts.slice(1).join(" ") : t;
  core = core.replace(/^d'/i,"").replace(/^d’/i,"").trim();
  return core;
}
function lettersFor(label){ return coreFromLabel(label).split(""); }

/* tiny inline check icon (image) */
const CHECK_ICON = 'data:image/svg+xml;utf8,' + encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <path fill="#1f1f1f" d="M25.2 46.6 10.7 32.1l5.7-5.7 8.8 8.8 22.4-22.4 5.7 5.7z"/>
</svg>`);

/* -------- Games -------- */
const GAMES = [
  { title:"Lauschter a schreif d'Wuert.", render: renderG1 },
  { title:"Lauschter a setz op déi richteg Plaz.", render: renderG2 }
];
let gi = 0;

/* Keep top bar buttons */
document.getElementById('prev').onclick = ()=>{ gi = (gi-1+GAMES.length)%GAMES.length; render(); };
document.getElementById('next').onclick = ()=>{ gi = (gi+1)%GAMES.length; render(); };

let handlers = { play:null, replay:null };
document.getElementById('play').onclick = ()=>{ if(handlers.play) handlers.play(); };
document.getElementById('replay').onclick = ()=>{ if(handlers.replay) handlers.replay(); };

function render(){
  const g = GAMES[gi];
  titleEl.textContent = g.title;
  box.innerHTML = "";
  handlers = { play:null, replay:null };
  g.render();
}

/* -------- GAME 1 -------- */
function renderG1(){
  const wrap = document.createElement("div");
  wrap.className = "g1";

  const topRow = document.createElement("div");
  topRow.className = "g1TopRow";

  const btnCheck = document.createElement("button");
  btnCheck.className = "iconBtn";
  btnCheck.type = "button";
  btnCheck.setAttribute("aria-label","Kucken");
  btnCheck.innerHTML = `<img src="${CHECK_ICON}" alt="">`;

  const btnClear = document.createElement("button");
  btnClear.className = "iconBtn";
  btnClear.type = "button";
  btnClear.setAttribute("aria-label","Eidel maachen");
  btnClear.innerHTML = `<img src="https://i.postimg.cc/BL81zWVs/p4replay.png" alt="">`;

  topRow.appendChild(btnCheck);
  topRow.appendChild(btnClear);

  const slots = document.createElement("div");
  slots.className = "g1Slots";

  const letters = document.createElement("div");
  letters.className = "g1Letters";

  wrap.appendChild(topRow);
  wrap.appendChild(slots);
  wrap.appendChild(letters);
  box.appendChild(wrap);

  let order = shuffle(ITEMS);
  let idx = 0;
  let expected = [];
  let placed = [];

  function build(){
    const it = order[idx];
    expected = lettersFor(it.label);
    placed = [];

    slots.innerHTML = "";
    for(let i=0;i<expected.length;i++){
      const s = document.createElement("div");
      s.className = "slot";
      s.dataset.i = String(i);
      s.onclick = ()=>{
        if(!s.classList.contains("filled")) return;
        const ch = s.textContent;
        s.textContent = "";
        s.classList.remove("filled","good","bad");
        // enable one matching disabled letter button
        const btn = letters.querySelector(`button[data-letter="${CSS.escape(ch)}"][disabled]`);
        if(btn) btn.disabled = false;
        // remove from placed (last match)
        for(let k=placed.length-1;k>=0;k--){
          if(placed[k]===ch){ placed.splice(k,1); break; }
        }
      };
      slots.appendChild(s);
    }

    letters.innerHTML = "";
    const pool = shuffle(expected.slice());
    pool.forEach(ch=>{
      const b = document.createElement("button");
      b.className = "letterBtn";
      b.type = "button";
      b.textContent = ch;
      b.dataset.letter = ch;
      b.onclick = ()=>{
        const empty = slots.querySelector(".slot:not(.filled)");
        if(!empty) return;
        empty.textContent = ch;
        empty.classList.add("filled");
        empty.classList.remove("good","bad");
        placed.push(ch);
        b.disabled = true;
      };
      letters.appendChild(b);
    });
  }

  function playCurrent(){ playAudio(order[idx].audio); }

  function clearAll(){
    letters.querySelectorAll("button.letterBtn").forEach(b=>b.disabled=false);
    slots.querySelectorAll(".slot").forEach(s=>{
      s.textContent="";
      s.classList.remove("filled","good","bad");
    });
    placed = [];
  }

  function check(){
    const got = [...slots.querySelectorAll(".slot")].map(s=>s.textContent||"");
    let ok = true;
    for(let i=0;i<expected.length;i++){
      if(got[i] !== expected[i]) ok=false;
    }
    slots.querySelectorAll(".slot").forEach((s,i)=>{
      s.classList.remove("good","bad");
      if(!s.textContent){ s.classList.add("bad"); return; }
      if(s.textContent === expected[i]) s.classList.add("good");
      else s.classList.add("bad");
    });
    if(ok){
      showToast("✔");
      setTimeout(()=>{
        idx = (idx+1) % order.length;
        build();
        playCurrent();
      }, 450);
    }else{
      slots.style.animation="shake .25s linear";
      setTimeout(()=>slots.style.animation="", 260);
      showToast("×");
    }
  }

  btnClear.onclick = ()=>{ clearAll(); };
  btnCheck.onclick = ()=>{ check(); };

  handlers.play = ()=>{ playCurrent(); };
  handlers.replay = ()=>{ clearAll(); playCurrent(); };

  build();
  playCurrent();
}

/* -------- GAME 2 -------- */
function renderG2(){
  const wrap = document.createElement("div");
  wrap.className = "g2";

  const stage = document.createElement("div");
  stage.className = "g2Stage";

  const bg = document.createElement("img");
  bg.className = "g2Img";
  bg.src = G2_BG;
  bg.alt = "";
  stage.appendChild(bg);

  const hitById = new Map(G2_HITS.filter(h=>h.h>0).map(h=>[h.id,h]));
  const itemById = new Map(ITEMS.map(it=>[it.id,it]));

  const overlays = new Map();
  const hits = new Map();

  for(const [id,h] of hitById){
    const btn = document.createElement("button");
    btn.className = "hit";
    btn.type = "button";
    btn.style.left = h.x + "%";
    btn.style.top  = h.y + "%";
    btn.style.width  = h.w + "%";
    btn.style.height = h.h + "%";

    const it = itemById.get(id);
    const ov = document.createElement("img");
    ov.className = "wordOnPill";
    if(it) ov.src = it.wordImg;

    btn.appendChild(ov);
    overlays.set(id, ov);
    hits.set(id, btn);
    stage.appendChild(btn);
  }

  const bubble = document.createElement("button");
  bubble.className = "bubble";
  bubble.type = "button";
  bubble.style.left = "6%";
  bubble.style.top  = "6%";
  bubble.innerHTML = `<img src="https://i.postimg.cc/WFDJyRHR/p4play.png" alt="">`;
  stage.appendChild(bubble);

  wrap.appendChild(stage);
  box.appendChild(wrap);

  let order = shuffle(ITEMS.filter(it=>hitById.has(it.id)));
  let idx = 0;
  let armed = false;

  function current(){ return order[idx]; }
  function playCurrent(){ const it=current(); if(it) playAudio(it.audio); }

  function flash(btn, ok){
    btn.classList.remove("flashGood","flashBad");
    void btn.offsetWidth;
    btn.classList.add(ok ? "flashGood" : "flashBad");
    setTimeout(()=>btn.classList.remove("flashGood","flashBad"), 260);
  }

  function advance(){
    idx++;
    if(idx >= order.length){
      showToast("✔");
      idx = 0;
      // reset overlays for a new run
      overlays.forEach(ov=>ov.style.display="none");
    }
    armed = false;
    bubble.classList.remove("armed");
  }

  bubble.onclick = ()=>{
    armed = !armed;
    bubble.classList.toggle("armed", armed);
    if(armed) playCurrent();
  };

  hits.forEach((btn,id)=>{
    btn.onclick = ()=>{
      if(!armed) return;
      const it = current();
      const ok = it && (id === it.id);
      if(ok){
        flash(btn,true);
        const ov = overlays.get(id);
        if(ov) ov.style.display = "block";
        showToast("✔");
        setTimeout(()=>{
          advance();
          playCurrent();
        }, 420);
      }else{
        flash(btn,false);
        showToast("×");
        armed = false;
        bubble.classList.remove("armed");
      }
    };
  });

  handlers.play = ()=>{ playCurrent(); };
  handlers.replay = ()=>{
    armed = false;
    bubble.classList.remove("armed");
    playCurrent();
  };

  playCurrent();
}

/* INIT */
render();
</script>

</body>
</html>
